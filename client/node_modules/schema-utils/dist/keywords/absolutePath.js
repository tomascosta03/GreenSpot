"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
<<<<<<< HEAD
<<<<<<< HEAD
/** @typedef {import("ajv").default} Ajv */
/** @typedef {import("ajv").SchemaValidateFunction} SchemaValidateFunction */
/** @typedef {import("ajv").AnySchemaObject} AnySchemaObject */
=======
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7

/** @typedef {import("ajv").Ajv} Ajv */

/** @typedef {import("ajv").ValidateFunction} ValidateFunction */

<<<<<<< HEAD
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
/** @typedef {import("../validate").SchemaUtilErrorObject} SchemaUtilErrorObject */

/**
 * @param {string} message
 * @param {object} schema
 * @param {string} data
 * @returns {SchemaUtilErrorObject}
 */
function errorMessage(message, schema, data) {
  return {
    // @ts-ignore
    // eslint-disable-next-line no-undefined
    dataPath: undefined,
    // @ts-ignore
    // eslint-disable-next-line no-undefined
    schemaPath: undefined,
    keyword: "absolutePath",
    params: {
      absolutePath: data
    },
    message,
    parentSchema: schema
  };
}
<<<<<<< HEAD
<<<<<<< HEAD

=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
/**
 * @param {boolean} shouldBeAbsolute
 * @param {object} schema
 * @param {string} data
 * @returns {SchemaUtilErrorObject}
 */
<<<<<<< HEAD
<<<<<<< HEAD
=======


>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======


>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
function getErrorFor(shouldBeAbsolute, schema, data) {
  const message = shouldBeAbsolute ? `The provided value ${JSON.stringify(data)} is not an absolute path!` : `A relative path is expected. However, the provided value ${JSON.stringify(data)} is an absolute path!`;
  return errorMessage(message, schema, data);
}
<<<<<<< HEAD
<<<<<<< HEAD

=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
/**
 *
 * @param {Ajv} ajv
 * @returns {Ajv}
 */
<<<<<<< HEAD
<<<<<<< HEAD
function addAbsolutePathKeyword(ajv) {
  ajv.addKeyword({
    keyword: "absolutePath",
    type: "string",
    errors: true,
    /**
     * @param {boolean} schema
     * @param {AnySchemaObject} parentSchema
     * @returns {SchemaValidateFunction}
     */
    compile(schema, parentSchema) {
      /** @type {SchemaValidateFunction} */
      const callback = data => {
        let passes = true;
        const isExclamationMarkPresent = data.includes("!");
        if (isExclamationMarkPresent) {
          callback.errors = [errorMessage(`The provided value ${JSON.stringify(data)} contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`, parentSchema, data)];
          passes = false;
        }

        // ?:[A-Za-z]:\\ - Windows absolute path
        // \\\\ - Windows network absolute path
        // \/ - Unix-like OS absolute path
        const isCorrectAbsolutePath = schema === /^(?:[A-Za-z]:(\\|\/)|\\\\|\/)/.test(data);
=======
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7


function addAbsolutePathKeyword(ajv) {
  ajv.addKeyword("absolutePath", {
    errors: true,
    type: "string",

    compile(schema, parentSchema) {
      /** @type {ValidateFunction} */
      const callback = data => {
        let passes = true;
        const isExclamationMarkPresent = data.includes("!");

        if (isExclamationMarkPresent) {
          callback.errors = [errorMessage(`The provided value ${JSON.stringify(data)} contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`, parentSchema, data)];
          passes = false;
        } // ?:[A-Za-z]:\\ - Windows absolute path
        // \\\\ - Windows network absolute path
        // \/ - Unix-like OS absolute path


        const isCorrectAbsolutePath = schema === /^(?:[A-Za-z]:(\\|\/)|\\\\|\/)/.test(data);

<<<<<<< HEAD
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
        if (!isCorrectAbsolutePath) {
          callback.errors = [getErrorFor(schema, parentSchema, data)];
          passes = false;
        }
<<<<<<< HEAD
<<<<<<< HEAD
        return passes;
      };
      callback.errors = [];
      return callback;
    }
  });
  return ajv;
}
=======
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7

        return passes;
      };

      callback.errors = [];
      return callback;
    }

  });
  return ajv;
}

<<<<<<< HEAD
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
=======
>>>>>>> 58a898f60b5c2e97f0cba20a4b73900a14201cd7
var _default = addAbsolutePathKeyword;
exports.default = _default;